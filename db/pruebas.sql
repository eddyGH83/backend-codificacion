-- Se tiene la siguiente tabla [cod_p20esp] con las columnas:

0esp|sec_cuestionario|i00     |i001a   |p20nro|respuesta   |codigocodif|codigocodif_v1|codigocodif_v2|estado    |usucre|feccre                 |usucodificador        |feccodificador         |usuverificador|fecverificador|usuverificador2|fecverificador2|respuesta_normalizada|departamento|orden|estado_norm|
----+----------------+--------+--------+------+------------+-----------+--------------+--------------+----------+------+-----------------------+----------------------+-----------------------+--------------+--------------+---------------+---------------+---------------------+------------+-----+-----------+
  30|           11772|01262698|00000000| 57606|CHILE       |152        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |chile                |ORURO       |    0|          1|
  31|           11758|01262775|00000000| 57536|IRLANDA     |372        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |irlanda              |ORURO       |    0|          1|
  32|           13272|01262851|00000000| 64982|ESPAÑA      |724        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |espana               |ORURO       |    0|          1|
  33|           13272|01262851|00000000| 64981|ESPAÑA      |724        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |espana               |ORURO       |    0|          1|
  34|           27576|01264257|00000000|135101|ARGENTINA   |032        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |argentina            |ORURO       |    0|          1|
  35|           82890|01266290|00000000|400129|VENEZUELA   |862        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |venezuela            |ORURO       |    0|          1|
  36|           43461|01267325|00000000|211316|CHILE       |152        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |chile                |ORURO       |    0|          1|
  37|           26889|01268846|00000000|131731|MEXICO      |484        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |mexico               |ORURO       |    0|          1|
  38|           65663|01274084|00000000|316364|CHILE       |152        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |chile                |ORURO       |    0|          1|
  39|           89347|01275505|00000000|431974|PERU        |604        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |peru                 |ORURO       |    0|          1|
  40|           33744|01282949|00000000|165342|BELARUS     |112        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |belarus              |ORURO       |    0|          1|
  41|           33744|01282949|00000000|165341|BELARUS     |112        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |belarus              |ORURO       |    0|          1|
  43|            4304|01290987|00000000| 21173|CANADA      |124        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |canada               |ORURO       |    0|          1|
  44|           33581|01293342|00000000|164532|EUROPA      |994        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |europa               |ORURO       |    0|          1|
  45|           65567|01296490|00000000|315919|SUECIA      |752        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |suecia               |ORURO       |    0|          1|
  46|           20315|01296542|00000000| 99576|INGLATERRA  |826        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |inglaterra           |ORURO       |    0|          1|
  47|           25717|01296893|00000000|125996|PERU        |604        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |peru                 |ORURO       |    0|          1|
  49|           35830|01304138|00000000|175548|MEXICO      |484        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |mexico               |ORURO       |    0|          1|
  51|            6833|01307228|00000000| 33188|PANDO       |068        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |pando                |ORURO       |    0|          1|
  52|           19038|01310492|00000000| 93331|ESPAÑA      |724        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |espana               |ORURO       |    0|          1|
  53|           30230|01310543|00000000|148053|PERU        |604        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |peru                 |ORURO       |    0|          1|
  55|           21653|01313120|00000000|106107|JAPON       |392        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |japon                |ORURO       |    0|          1|
  56|           62603|01314003|00000000|303729|ITALIA      |380        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |italia               |ORURO       |    0|          1|
  57|           28696|01314058|00000000|140572|CANADA      |124        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |canada               |ORURO       |    0|          1|
  58|           28696|01314058|00000000|140573|CANADA      |124        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |canada               |ORURO       |    0|          1|
  59|           28696|01314058|00000000|140571|CANADA      |124        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |canada               |ORURO       |    0|          1|
  60|           40546|01314236|00000000|197926|HONDURAS    |340        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |honduras             |ORURO       |    0|          1|
  61|           27651|01314263|00000000|135466|SUECIA      |752        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |suecia               |ORURO       |    0|          1|
  62|           27891|01314472|00000000|136651|BELGICA     |056        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |belgica              |ORURO       |    0|          1|
  63|           40712|01315289|00000000|198631|PERU        |604        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |peru                 |ORURO       |    0|          1|
  64|           38960|01316493|00000000|190816|CANADA      |124        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |canada               |ORURO       |    0|          1|
  65|           29280|01317107|00000000|143426|SUECIA      |752        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |suecia               |ORURO       |    0|          1|
  66|           24770|01317306|00000000|121336|ITALIA      |380        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |italia               |ORURO       |    0|          1|
  67|           28630|01317940|00000000|140246|VENEZUELA   |862        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |venezuela            |ORURO       |    0|          1|
  68|           36572|01318116|00000000|179111|VENEZUELA   |862        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |venezuela            |ORURO       |    0|          1|
  71|           44169|01321669|00000000|214776|ARGENTINA   |032        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |argentina            |ORURO       |    0|          1|
  72|           16908|01323005|00000000| 82766|SUECIA      |752        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |suecia               |ORURO       |    0|          1|
  73|            6889|01324775|00000000| 33469|ITALIA      |380        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |italia               |ORURO       |    0|          1|
  74|            1645|01325182|00000000|  8033|PERU        |604        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |peru                 |ORURO       |    0|          1|
  76|           32415|01330681|00000000|158766|R DOMINICANA|222        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |rdominicana          |ORURO       |    0|          1|
  77|           35896|01333139|00000000|175876|JAPON       |392        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |japon                |ORURO       |    0|          1|
  78|           25945|01335800|00000000|127111|FRANCIA     |250        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |francia              |ORURO       |    0|          1|
  79|           18207|01336799|00000000| 89211|PERU        |604        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |peru                 |ORURO       |    0|          1|
  80|           29608|01337768|00000000|145021|PERU        |604        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |peru                 |ORURO       |    0|          1|
  81|           32016|01339130|00000000|156802|HONDURAS    |340        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |honduras             |ORURO       |    0|          1|
  82|           34692|01339370|00000000|170001|ALEMANIA    |276        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |alemania             |ORURO       |    0|          1|
  83|           32271|01342230|00000000|158052|MEXICO      |484        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |mexico               |ORURO       |    0|          1|
  85|           22600|01344558|00000000|110817|IRLANDA     |372        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |irlanda              |ORURO       |    0|          1|
  86|           22600|01344558|00000000|110818|IRLANDA     |372        |              |              |CODIFICADO|admin |2024-06-25 19:53:56.918|AUTOMATICO_NORMALIZADO|2024-06-25 22:49:57.761|              |              |               |               |irlanda              |ORURO       |    0|          1|

-- Script para mostrar los primeros 10 registros de la tabla cod_p20esp
select * from cod_p20esp limit 10;

-- Script para agrupa por la columna i00 y contar estado='CODIFICADO' y estado<>'CODIFICADO'


-------------------------------
SELECT cod.i00, count(cod.i00) FROM (
	SELECT  i00, count(i00) cant, 'p20esp' pregunta FROM codificacion.cod_p20esp WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00 
	UNION 
	SELECT  i00, count(i00) cant, 'p32esp' pregunta FROM codificacion.cod_p32esp WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION 
	SELECT  i00, count(i00) cant, 'p331' pregunta FROM codificacion.cod_p331 WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION 
	SELECT  i00, count(i00) cant, 'p332' pregunta FROM codificacion.cod_p332 WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION 
	SELECT  i00, count(i00) cant, 'p333' pregunta FROM codificacion.cod_p333 WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p341' pregunta FROM codificacion.cod_p341 WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p352a' pregunta FROM codificacion.cod_p352a WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p353' pregunta FROM codificacion.cod_p353 WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p362a' pregunta FROM codificacion.cod_p362a WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p363' pregunta FROM codificacion.cod_p363 WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p372a' pregunta FROM codificacion.cod_p372a WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p373' pregunta FROM codificacion.cod_p373 WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p48esp' pregunta FROM codificacion.cod_p48esp WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
	UNION
	SELECT  i00, count(i00) cant, 'p49_p51' pregunta FROM codificacion.cod_p49_p51 
	WHERE estado_ocu IN ('CODIFICADO', 'VERIFICADO') AND estado_act IN ('CODIFICADO', 'VERIFICADO') AND codigocodif_ocu IS NOT NULL AND codigocodif_act IS NOT NULL GROUP BY i00
	UNION 
	SELECT  i00, count(i00) cant, 'p52esp' pregunta FROM codificacion.cod_p52esp WHERE estado IN ('CODIFICADO', 'VERIFICADO') AND codigocodif IS NOT NULL GROUP BY i00
) AS cod GROUP BY cod.i00



-- tengo archivos en la carpeta actual, esta carpeta tiene archivos pdf, 
-- necesito una lista de los archivos pdf que estan en la carpeta actual y guardarlos en un archivo llamado lista_pdf.txt
-- desde el cmd de windows, en la carpeta actual, ejecutar el siguiente comando
dir /b *.pdf > lista_pdf.txt


--  crear tabla con los capos secuencial, i00, i001a, cont_creacion, fecha_creacion, cod_depto, obs 
CREATE TABLE codificacion.seg_vivienda (
  secuencial bigint,
  i00 varchar(16),
  i001a varchar(16),  
  nro bigint,
  cont_creacion int,  
  fecha_creacion timestamp DEFAULT CURRENT_TIMESTAMP,  
  cod_depto varchar(4),
  obs text
);


CREATE TABLE codificacion.seg_personas (
  secuencial bigint,
  i00 varchar(16),
  i001a varchar(16),  
  nro bigint,
  cont_creacion int,  
  fecha_creacion timestamp DEFAULT CURRENT_TIMESTAMP,  
  cod_depto varchar(4),
  obs text
);


CREATE TABLE codificacion.seg_emigracion (
  secuencial bigint,
  i00 varchar(16),
  i001a varchar(16),  
  nro bigint,
  cont_creacion int,  
  fecha_creacion timestamp DEFAULT CURRENT_TIMESTAMP,  
  cod_depto varchar(4),
  obs text
);

-- estructuras.inicial0_capitulo_personas definition

-- Drop table

-- DROP TABLE estructuras.inicial0_capitulo_personas;

CREATE TABLE estructuras.inicial0_capitulo_personas (
	secuencial int4 NULL,
	i00 varchar(8) NULL,
	i001a varchar(8) NULL,
	nro int4 NULL,
	nombre varchar(100) NULL,
	mpo int4 NULL,
	p24 int4 NULL,
	p25 int4 NULL,
	p26 varchar(3) NULL,
	p27a varchar(2) NULL,
	p27b varchar(2) NULL,
	p27c varchar(4) NULL,
	p28 int4 NULL,
	p29 int4 NULL,
	p301 int4 NULL,
	p302 int4 NULL,
	p303 int4 NULL,
	p304 int4 NULL,
	p305 int4 NULL,
	p306 int4 NULL,
	p307 int4 NULL,
	p31 int4 NULL,
	p32 int4 NULL,
	p32esp varchar(18) NULL,
	p331 varchar(18) NULL,
	p332 varchar(18) NULL,
	p333 varchar(18) NULL,
	p334 int4 NULL,
	p341 varchar(18) NULL,
	p342 int4 NULL,
	p35 int4 NULL,
	p352a varchar(50) NULL,
	p352b varchar(18) NULL,
	p353 varchar(50) NULL,
	p353b varchar(4) NULL,
	p36 int4 NULL,
	p361 varchar(4) NULL,
	p362a varchar(50) NULL,
	p362b varchar(18) NULL,
	p363 varchar(16) NULL,
	p37 int4 NULL,
	p372a varchar(16) NULL,
	p372b int4 NULL,
	p373 varchar(16) NULL,
	p38 int4 NULL,
	p39 int4 NULL,
	p40 int4 NULL,
	p41a int4 NULL,
	p41b int4 NULL,
	p42a int4 NULL,
	p42b int4 NULL,
	p42c int4 NULL,
	p42d int4 NULL,
	p43 int4 NULL,
	p44 int4 NULL,
	p45 int4 NULL,
	p46 int4 NULL,
	p47 int4 NULL,
	p48 int4 NULL,
	p48esp varchar(50) NULL,
	p49 varchar(100) NULL,
	p50 int4 NULL,
	p51 varchar(100) NULL,
	p52 int4 NULL,
	p52esp varchar(16) NULL,
	p53 int4 NULL,
	p54 varchar(2) NULL,
	p54a varchar(2) NULL,
	p54b varchar(2) NULL,
	p55 varchar(2) NULL,
	p55a varchar(2) NULL,
	p55b varchar(2) NULL,
	p56 varchar(2) NULL,
	p57a int4 NULL,
	p57b varchar(4) NULL,
	p58 int4 NULL,
	p59 int4 NULL,
	cod_depto varchar(2) NULL,
	cod_prov varchar(2) NULL,
	cod_mpio varchar(2) NULL,
	cod_cd_com varchar(5) NULL,
	zona varchar(2) NULL,
	sector varchar(8) NULL,
	segmento varchar(8) NULL,
	p25_sexo_aux_01 int4 NULL,
	p25_sexo_aux_02 int4 NULL,
	p25_sexo_ocup_aux_01 int4 NULL,
	p391_tipest_p383_aux int4 NULL,
	p392_tipest_p385_aux int4 NULL,
	con_mpio varchar(6) NULL,
	p32esp_cod varchar(10) NULL,
	p331_cod varchar(10) NULL,
	p332_cod varchar(10) NULL,
	p333_cod varchar(10) NULL,
	p341_cod varchar(10) NULL,
	p35a_cod varchar(10) NULL,
	p353_cod varchar(10) NULL,
	p36a_cod varchar(10) NULL,
	p363_cod varchar(10) NULL,
	p372a_cod varchar(10) NULL,
	p373_cod varchar(10) NULL,
	p48esp_cod varchar(10) NULL,
	p49_cod varchar(10) NULL,
	p51_cod varchar(10) NULL,
	p52esp_cod varchar(10) NULL,
	n2_aux int4 NULL
);

--- Insertar datos en la tabla seg_personas desde la tabla estructuras.inicial0_capitulo_personas
INSERT INTO codificacion.seg_personas (secuencial, i00, i001a, nro, cont_creacion, fecha_creacion, cod_depto, obs)
SELECT secuencial, i00, i001a, nro, 3, now(), cod_depto, ''
FROM estructuras.inicial0_capitulo_personas  
where estructuras.cod_depto ='04';


